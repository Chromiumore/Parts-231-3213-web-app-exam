{% extends 'base.html' %}

{% block content %}
<h1>–†–µ—Ü–µ–ø—Ç—ã</h1>
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-3">
    {% if not recipes %}
    <p>–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞ üòî</p>
    {% else %}
    {% for recipe in recipes %}
    <div class="column">
        <div class="card recipe-card">
            <div class="card-body">
                <h5 class="card-title">{{ recipe.name }}</h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">–í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è: {{ recipe.time }} –º–∏–Ω—É—Ç</li>
                    <li class="list-group-item">–ü–æ—Ä—Ü–∏–π: {{ recipe.portions }}</li>
                    <li class="list-group-item">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: {{ {1: '–ü–ª–æ—Ö–æ', 2: '–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ', 3: '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ', 4: '–•–æ—Ä–æ—à–æ', 5: '–û—Ç–ª–∏—á–Ω–æ'}[recipe.get_avg_rating() |round] | default('—É–∂–∞—Å–Ω–æ') }}</li>
                    <li class="list-group-item">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤: {{ recipe.get_feedbacks_number() }}</li>
                </ul>
                <div class="card-footer">
                    <a href="{{ url_for('recipes.view', recipe_id=recipe.id) }}" class="btn btn-primary">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                    {% if current_user.is_authenticated and (current_user.get_role_name() == 'admin' or current_user.id == recipe.user_id) %}
                    <a href="{{ url_for('recipes.edit', recipe_id=recipe.id) }}" class="btn btn-primary"><i class="fa-solid fa-pen-to-square"></i></a>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#deleteModal" data-recipe-id="{{ recipe.id }}"><i class="fa-solid fa-trash"></i></button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    {% endif %}
</div>

{% if current_user.is_authenticated %}
<div class="container sticky-bottom" id="addRecipeBottomButton">
    <a href="{{ url_for('recipes.new') }}" class="btn btn-primary h-100 w-100">–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç</a>
</div>
{% endif %}

<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="deleteModalLabel">–£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                <form method="post" id="deleteModalForm">
                    <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='delete_recipe_modal.js') }}"></script>
{% endblock %}
